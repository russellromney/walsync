---
title: CLI Commands
description: Complete reference for Walsync command-line interface
---

## Overview

Walsync provides four main commands:

```bash
walsync <COMMAND> [OPTIONS]
```

## Commands

### `watch` - Monitor and sync databases

Continuously monitor database files and sync changes to S3.

```bash
walsync watch <DATABASES>... -b <BUCKET> [OPTIONS]
```

**Arguments:**
- `<DATABASES>` - Paths to SQLite database files (space-separated)

**Options:**
- `-b, --bucket <BUCKET>` - S3 bucket path (e.g., `s3://my-bucket/prefix`)
- `--endpoint <URL>` - S3 endpoint for Tigris, MinIO, etc.
- `--snapshot-interval <SECS>` - Snapshot interval in seconds (default: 3600)

**Example:**
```bash
# Watch multiple databases
walsync watch db1.db db2.db -b s3://backups

# With Tigris endpoint
walsync watch /data/*.db -b s3://backups --endpoint https://fly.storage.tigris.dev

# Custom snapshot interval (30 minutes)
walsync watch app.db -b s3://backups --snapshot-interval 1800
```

**Behavior:**
- Monitors all database files for changes
- Uploads new WAL frames to S3 automatically
- Takes full snapshots at specified intervals
- Runs indefinitely until stopped (Ctrl+C)

### `snapshot` - Take immediate snapshot

Upload current database state to S3 as a snapshot.

```bash
walsync snapshot <DATABASE> -b <BUCKET> [OPTIONS]
```

**Arguments:**
- `<DATABASE>` - Path to SQLite database file

**Options:**
- `-b, --bucket <BUCKET>` - S3 bucket path
- `--endpoint <URL>` - S3 endpoint

**Example:**
```bash
walsync snapshot /data/app.db -b s3://backups
```

**Output:**
```
Snapshot uploaded: s3://backups/app/snapshots/20240112120000.db
```

### `restore` - Restore database from S3

Download and restore database from S3 backup.

```bash
walsync restore <NAME> -o <OUTPUT> -b <BUCKET> [OPTIONS]
```

**Arguments:**
- `<NAME>` - Database name (as stored in S3)

**Options:**
- `-o, --output <OUTPUT>` - Output file path
- `-b, --bucket <BUCKET>` - S3 bucket path
- `--endpoint <URL>` - S3 endpoint
- `--point-in-time <ISO8601>` - Restore to specific point in time (optional)

**Example:**
```bash
# Restore latest snapshot
walsync restore myapp -o /data/recovered.db -b s3://backups

# Restore to specific point in time
walsync restore myapp -o /data/recovered.db -b s3://backups \
  --point-in-time 2024-01-12T12:00:00Z
```

**Process:**
1. Downloads latest snapshot
2. Verifies SHA256 checksum
3. Applies WAL segments after snapshot time
4. Writes to output path
5. Confirms checksum match

### `list` - List backed-up databases

Show all databases currently backed up in S3.

```bash
walsync list -b <BUCKET> [OPTIONS]
```

**Options:**
- `-b, --bucket <BUCKET>` - S3 bucket path
- `--endpoint <URL>` - S3 endpoint

**Example:**
```bash
walsync list -b s3://backups
```

**Output:**
```
  myapp (5 snapshots, 12 WAL segments)
  other (2 snapshots, 3 WAL segments)
```

## Global Options

These work with all commands:

```bash
# Enable debug logging
RUST_LOG=debug walsync watch app.db -b s3://backups

# Custom AWS credentials
AWS_ACCESS_KEY_ID=key AWS_SECRET_ACCESS_KEY=secret \
  walsync snapshot app.db -b s3://backups
```

## Environment Variables

Walsync uses standard AWS SDK variables:

- `AWS_ACCESS_KEY_ID` - AWS/Tigris access key
- `AWS_SECRET_ACCESS_KEY` - AWS/Tigris secret key
- `AWS_ENDPOINT_URL_S3` - S3 endpoint URL (for Tigris, MinIO)
- `AWS_REGION` - AWS region (default: `us-east-1`)
- `RUST_LOG` - Logging level (`debug`, `info`, `warn`, `error`)

### Tigris Setup

```bash
export AWS_ACCESS_KEY_ID=your_tigris_key
export AWS_SECRET_ACCESS_KEY=your_tigris_secret
export AWS_ENDPOINT_URL_S3=https://fly.storage.tigris.dev
export AWS_REGION=auto
```

### MinIO Setup

```bash
export AWS_ACCESS_KEY_ID=minioadmin
export AWS_SECRET_ACCESS_KEY=minioadmin
export AWS_ENDPOINT_URL_S3=https://minio.example.com:9000
export AWS_REGION=us-east-1
```

## Exit Codes

- `0` - Success
- `1` - General error (missing file, S3 error, etc.)
- `2` - Invalid arguments
- `3` - Checksum mismatch (data corruption detected)

## Tips

### Multiple Databases

Watch all databases in a directory:
```bash
walsync watch /var/lib/app/*.db -b s3://backups
```

### Background Process

Run as a background service:
```bash
# Systemd service
nohup walsync watch app.db -b s3://backups > /var/log/walsync.log 2>&1 &

# Or use supervisor, systemd, etc.
```

### Monitoring

Check logs with:
```bash
RUST_LOG=info walsync watch app.db -b s3://backups
```

Monitor snapshots:
```bash
while true; do
  echo "=== $(date) ==="
  walsync list -b s3://backups
  sleep 300  # Every 5 minutes
done
```

---

See [Quick Start](/start/quickstart) for examples or [Configuration](/guide/config) for advanced options.
